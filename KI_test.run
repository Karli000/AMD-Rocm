#!/bin/bash
LOG="KI_test.log"
echo "üß™ ROCm Komponententest gestartet: $(date)" > "$LOG"

# üì¶ Python-Version erkennen (z.‚ÄØB. 3.12)
PY_VER=$(python3 -c "import sys; print(f'{sys.version_info.major}.{sys.version_info.minor}')")
PY_FULL="python${PY_VER}-full"
PY_VENV="python${PY_VER}-venv"
PY_BASE="python${PY_VER}"

# üîç Pr√ºfen, ob python3 vorhanden ist
if ! command -v python3 &>/dev/null; then
  echo "‚ö†Ô∏è Python3 ist nicht installiert ‚Äì wird jetzt installiert..."
  sudo apt update
  sudo apt install -y $PY_BASE
fi

# üîß Venv + Pip-Voraussetzungen installieren
sudo apt update
sudo apt install -y $PY_VENV $PY_FULL

# üß† venv erstellen + aktivieren
python3 -m venv ~/rocm_venv
source ~/rocm_venv/bin/activate

# üì¶ Pakete installieren
pip install --upgrade pip notebook tensorflow matplotlib pandas

# üöÄ HIP Test
hipcc --version &>/dev/null && HIP_STATUS="‚úÖ verf√ºgbar" || HIP_STATUS="‚ùå fehlt"

# üìò Jupyter Test
~/rocm_venv/bin/jupyter --version &>/dev/null && JUPYTER_STATUS="‚úÖ verf√ºgbar" || JUPYTER_STATUS="‚ùå fehlt"

# üé® Blender Test
blender --version &>/dev/null && BLENDER_STATUS="‚úÖ verf√ºgbar" || BLENDER_STATUS="‚ùå fehlt"

# üß† TensorFlow Test
~/rocm_venv/bin/python -c "import tensorflow" &>/dev/null && TENSORFLOW_STATUS="‚úÖ verf√ºgbar" || TENSORFLOW_STATUS="‚ùå fehlt"

# üìä Komponententabelle
echo -e "\nüìä Komponententabelle:" | tee -a "$LOG"
echo -e "| Komponente   | Funktionstest         | Status             |" | tee -a "$LOG"
echo -e "|--------------|-----------------------|--------------------|" | tee -a "$LOG"
echo -e "| HIP          | hipcc --version       | ${HIP_STATUS}      |" | tee -a "$LOG"
echo -e "| Jupyter      | CLI-Versionstest      | ${JUPYTER_STATUS}  |" | tee -a "$LOG"
echo -e "| Blender      | blender --version     | ${BLENDER_STATUS}  |" | tee -a "$LOG"
echo -e "| TensorFlow   | Import im venv        | ${TENSORFLOW_STATUS}|" | tee -a "$LOG"

echo -e "\n‚úÖ Test abgeschlossen! Ergebnisse gespeichert in $LOG"
