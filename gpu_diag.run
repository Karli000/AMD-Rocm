#!/bin/bash
# gpu_diag.run â€“ Diagnose-Skript fÃ¼r RDNA2-GPUs mit ROCm unter Ubuntu
# Version: 1.0 â€“ Erstellt von Karli000 ğŸ› ï¸

echo "=== RDNA2 GPU Diagnose Tool ==="
echo "Systemzeit: $(date)"
echo "--------------------------------"

# Temperatur & LÃ¼fter auslesen
echo "ğŸŒ¡ï¸ Temperatur & LÃ¼fterdaten:"
for file in /sys/class/hwmon/hwmon*/temp*_input; do
  label=$(basename "$file")
  value=$(cat "$file")
  echo "  $label: $((value/1000))Â°C"
done

for fan in /sys/class/hwmon/hwmon*/fan*_input; do
  label=$(basename "$fan")
  value=$(cat "$fan")
  echo "  $label: $value RPM"
done

# ROCm-SMI Werte anzeigen
echo ""
echo "ğŸ“¦ ROCm-SMI Status:"
rocm-smi | grep -v "^=" | grep -v "^$"

# ZusÃ¤tzliche Infos aus amdgpu_pm_info
echo ""
echo "âš¡ amdgpu_pm_info:"
sudo cat /sys/kernel/debug/dri/0/amdgpu_pm_info 2>/dev/null || echo "Nicht verfÃ¼gbar oder nicht geladen"

# Sensors als Fallback anzeigen
echo ""
echo "ğŸ§­ sensors-Ausgabe:"
sensors | grep -E 'edge|temp|fan|RPM' || echo "Keine sensors-Werte verfÃ¼gbar"

echo ""
echo "âœ… Fertig. Du kannst dieses Skript erweitern oder die Ausgabe in eine Logdatei schreiben."
