#!/bin/bash
# Vollinstallation fÃ¼r ROCm HIP GPU-Stresstest mit Blender

echo "ğŸš€ Starte Komplettinstallation fÃ¼r HIP-Stresstest..."

# ğŸ› ï¸ Systemtools
sudo apt update
sudo apt install -y wget git unzip jq python3-pip clinfo rocminfo

# ğŸ§± ROCm Installation (angepasst fÃ¼r RDNA2/3)
wget https://raw.githubusercontent.com/Karli000/AMD-Rocm/main/rocm_rdna2_auto.run -O rocm_install.run
chmod +x rocm_install.run
./rocm_install.run

# ğŸ¬ Blender mit HIP (v4.0.2 portable)
mkdir -p ~/blender_hip
cd ~/blender_hip
wget https://mirror.clarkson.edu/blender/release/Blender4.0/blender-4.0.2-linux-x64.tar.xz
tar -xf blender-4.0.2-linux-x64.tar.xz
BLENDER=~/blender_hip/blender-4.0.2-linux-x64/blender

# ğŸ–¼ï¸ Testszene fÃ¼r Volllast
wget https://blenderstudio.s3.nl-ams.scw.cloud/production-files/agent327/Agent327_Character.blend -O stress_test.blend

# ğŸ”¥ Stresstest-Skript erstellen
cat <<EOF > gpu_stress_blender_hip.sh
#!/bin/bash
BLENDER="$BLENDER"
SCENE="stress_test.blend"
OUTPUT="/tmp/hip_stress_####"
RES_X=3840
RES_Y=2160
FRAMES=20
START=\$(date +%s)
echo "ğŸ”¥ Blender HIP Stresstest â€“ 4K Szene mit \$FRAMES Frames"
"\$BLENDER" -b "\$SCENE" --engine CYCLES --render-output "\$OUTPUT" -f 1..\$FRAMES -- --cycles-device HIP
END=\$(date +%s)
echo "âœ… Dauer: \$((END - START)) Sekunden (~\$(((END - START)/60)) Minuten)"
EOF

chmod +x gpu_stress_blender_hip.sh
echo "âœ… Fertig! Starte den Stresstest mit: ./gpu_stress_blender_hip.sh"
