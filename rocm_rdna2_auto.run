LOG="rocm_setup.log"
echo "üöÄ ROCm Setup gestartet: $(date)" > "$LOG"

# üß™ System-Check: Ubuntu-Version & Kernel
UBUNTU=$(lsb_release -rs)
KERNEL=$(uname -r | cut -d '-' -f1)
MAJOR=$(echo "$KERNEL" | cut -d '.' -f1)
MINOR=$(echo "$KERNEL" | cut -d '.' -f2)
CURRENT="$MAJOR.$MINOR"

echo "üì¶ Ubuntu-Version: $UBUNTU" | tee -a "$LOG"
echo "üì¶ Kernel-Version: $CURRENT" | tee -a "$LOG"

# ‚úÖ ROCm-Kompatibilit√§t
COMPAT=false
if [[ "$UBUNTU" == "22.04" && ( "$CURRENT" == "5.15" || "$CURRENT" == "6.8" ) ]]; then
    COMPAT=true
elif [[ "$UBUNTU" == "24.04" && ( "$CURRENT" == "6.8" || "$CURRENT" == "6.14" ) ]]; then
    COMPAT=true
fi

if [ "$COMPAT" = true ]; then
    echo "‚úÖ Ubuntu $UBUNTU + Kernel $CURRENT sind mit ROCm kompatibel!" | tee -a "$LOG"
else
    echo "‚ùå Kombination nicht offiziell unterst√ºtzt ‚Äì Installation trotzdem fortgesetzt (Fallback ROCm-Version m√∂glich)" | tee -a "$LOG"
fi

# üéÆ GPU-Erkennung (RX 6000 Serie / Navi 2x)
GPU_RAW=$(lspci | grep VGA | grep -i amd)
echo "üîç GPU-Erkennung:" | tee -a "$LOG"
echo "$GPU_RAW" | tee -a "$LOG"

if echo "$GPU_RAW" | grep -Ei "RX 6[4-9]00|6600|6700|6800|6900|Navi 2[1-4]" > /dev/null; then
    echo "‚úÖ RDNA2 GPU erkannt (RX 6000-Serie)" | tee -a "$LOG"
else
    echo "‚ö†Ô∏è Keine bekannte RDNA2-GPU erkannt ‚Äì ggf. manuell pr√ºfen!" | tee -a "$LOG"
fi
