#!/bin/bash
# rocmtop.run â€“ ROCm GPU Monitor im nvtop-Style ğŸ§ 

clear
echo -e "\e[1;36m=== Starte rocmtop (aktualisiert alle 1s) ===\e[0m"
echo -e "DrÃ¼cke [Ctrl+C] zum Beenden\n"

# GPU-Erkennung via rocminfo & rocm-smi
DEVICE_ID=$(rocm-smi | grep -Eo '0x[0-9a-f]{4}' | head -n 1)
GFX=$(rocminfo | grep -i 'gfx' | grep -o 'gfx[0-9]*' | head -n 1)

# Mini-Mapping basierend auf gfx-Code
case "$GFX" in
  gfx1030) MODEL="RX 6800 / RX 6900";;
  gfx1032) MODEL="RX 6600 / RX 6600 XT";;
  gfx1100) MODEL="RX 7900 XT / XTX";;
  gfx900)  MODEL="Vega 56 / 64";;
  *)       MODEL="Unbekanntes Modell";;
esac

echo -e "ğŸ§  GPU erkannt: $MODEL [$GFX] | Device-ID: $DEVICE_ID"
echo -e "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

while true; do
  clear
  TIMESTAMP=$(date "+%H:%M:%S")
  echo -e "ğŸ•’ $TIMESTAMP â€“ ROCm GPU Monitoring"
  echo -e "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"

  rocm-smi | grep -E '^[0-9]' | while read -r line; do
    TEMP=$(echo "$line" | awk '{print $4}')
    POWER=$(echo "$line" | awk '{print $6}')
    SCLK=$(echo "$line" | awk '{print $8}')
    MCLK=$(echo "$line" | awk '{print $9}')
    FAN=$(echo "$line" | awk '{print $10}')
    GPU=$(echo "$line" | awk '{print $12}')

    printf "ğŸŒ¡ï¸  Temp: %-8s | ğŸ”‹ Power: %-8s | ğŸŒ€ Fan: %-7s | â±ï¸ SCLK: %-6s | MCLK: %-6s | ğŸš€ GPU%%: %-4s\n" \
      "$TEMP" "$POWER" "$FAN" "$SCLK" "$MCLK" "$GPU"
  done

  sleep 1
done
